#==============================================================================
# Compression Configuration - Brotli + Gzip
#==============================================================================

#------------------------------------------------------------------------------
# Brotli Compression (Primary)
#------------------------------------------------------------------------------
<IfModule mod_brotli.c>
    # Basic Brotli parameters
    BrotliCompressionMaxInputBlock 16
    BrotliCompressionQuality 6
    BrotliCompressionWindow 18

    # Apply Brotli to common web content types
    AddOutputFilterByType BROTLI_COMPRESS \
        text/html \
        text/plain \
        text/xml \
        text/css \
        text/javascript \
        application/javascript \
        application/x-javascript \
        application/json \
        application/xml \
        application/xhtml+xml \
        image/svg+xml

    # Don't compress already compressed files
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|webp|woff2?|ico|zip|gz|br|rar|bz2|7z|tar)$ \
        no-brotli

    # Set proper Vary header
    <IfModule mod_headers.c>
        Header merge Vary "Accept-Encoding"
    </IfModule>
</IfModule>

#------------------------------------------------------------------------------
# Gzip Compression (Fallback)
#------------------------------------------------------------------------------
<IfModule mod_deflate.c>
    # Only use gzip if Brotli module is not available
    <IfModule !mod_brotli.c>
        # Basic deflate parameters
        DeflateCompressionLevel 6

        # Apply to same content types as Brotli
        AddOutputFilterByType DEFLATE \
            text/html \
            text/plain \
            text/xml \
            text/css \
            text/javascript \
            application/javascript \
            application/x-javascript \
            application/json \
            application/xml \
            application/xhtml+xml \
            image/svg+xml

        # Don't compress already compressed files
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|webp|woff2?|ico|zip|gz|br|rar|bz2|7z|tar)$ \
            no-gzip

        # Set proper Vary header
        <IfModule mod_headers.c>
            Header merge Vary "Accept-Encoding"
        </IfModule>
    </IfModule>
</IfModule>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
