#==============================================================================
# Apache 2.4.62+ Main Configuration - Modular
# Production-ready configuration for Yii2 with HTTP/2 and PHP-FPM
#==============================================================================

#------------------------------------------------------------------------------
# Basic Directory Security
#------------------------------------------------------------------------------
<Directory />
    Options -Indexes -Includes -ExecCGI -FollowSymLinks
    AllowOverride None
    Require all denied
</Directory>

<Directory /usr/share>
    AllowOverride None
    Require all granted
</Directory>

<Directory /var/www/>
    Options -Indexes +FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

#------------------------------------------------------------------------------
# Core Server Settings
#------------------------------------------------------------------------------
DefaultRuntimeDir ${APACHE_RUN_DIR}
ErrorLog ${APACHE_ERROR_LOG_FILE}
Group ${APACHE_RUN_GROUP}
Listen 80
Mutex file:${APACHE_LOCK_DIR} default
PassEnv APACHE_DOCUMENT_ROOT
PidFile ${APACHE_PID_FILE}
ServerName localhost
ServerRoot "/etc/apache2"
User ${APACHE_RUN_USER}

#------------------------------------------------------------------------------
# MIME Types
#------------------------------------------------------------------------------
<IfModule mime_module>
    TypesConfig /etc/mime.types

    # Modern MIME types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType application/x-bzip2 .bz2
    AddType application/wasm .wasm
    AddType application/font-woff2 .woff2
    AddType application/manifest+json .webmanifest
    AddType text/javascript .mjs
</IfModule>

#------------------------------------------------------------------------------
# Modular Configuration Includes
#------------------------------------------------------------------------------
# Performance
Include /etc/apache2/conf-available/01-performance.conf

# Security
Include /etc/apache2/conf-available/02-security.conf

# SSL/TLS
Include /etc/apache2/conf-available/03-ssl-tls.conf

# Compression
Include /etc/apache2/conf-available/04-compression.conf

# PHP-FPM Proxy
Include /etc/apache2/conf-available/06-php-fpm.conf

# Logging
Include /etc/apache2/conf-available/07-logging.conf

# Rate Limiting and Traffic Control
Include /etc/apache2/conf-available/08-rate-limiting.conf

# Loaded modules
IncludeOptional mods-enabled/*.load
IncludeOptional mods-enabled/*.conf

# Other
IncludeOptional conf-enabled/*.conf
IncludeOptional sites-enabled/*.conf

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
