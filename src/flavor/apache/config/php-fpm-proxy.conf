#==============================================================================
# Apache PHP-FPM Proxy Configuration
#==============================================================================

# PHP-FPM proxy configuration via Unix socket
<Proxy "unix:/var/run/php/php-fpm.sock|fcgi://php-fpm">
    ProxySet connectiontimeout=5 timeout=60
</Proxy>

# Handle PHP files
<FilesMatch "\.php$">
    <If "-f %{REQUEST_FILENAME}">
        SetHandler "proxy:unix:/var/run/php/php-fpm.sock|fcgi://localhost"
    </If>
</FilesMatch>

# Security: Deny access to PHP source files that shouldn't be served
<FilesMatch "\.phps$">
    Require all denied
</FilesMatch>

# Deny access to files with .php. in the name (like file.php.txt)
<FilesMatch "\.php\.">
    Require all denied
</FilesMatch>

# Deny access to user ini files
<Files ".user.ini">
    Require all denied
</Files>

# Pass Authorization header to PHP
SetEnvIfNoCase ^Authorization$ "(.+)" HTTP_AUTHORIZATION=$1

# Directory index for PHP
DirectoryIndex index.php index.html

# PHP-FPM status and ping pages (development only)
<IfDefine ENABLE_FPM_STATUS>
    <Location /fpm-status>
        SetHandler "proxy:unix:/var/run/php/php-fpm.sock|fcgi://localhost"
        Require local
    </Location>

    <Location /fpm-ping>
        SetHandler "proxy:unix:/var/run/php/php-fpm.sock|fcgi://localhost"
        Require local
    </Location>
</IfDefine>
