#==============================================================================
# Apache Virtual Host Configuration for Yii2 with HTTP/2 and Redirect to HTTPS
#==============================================================================

#------------------------------------------------------------------------------
# HTTP Virtual Host
#------------------------------------------------------------------------------
<VirtualHost *:80>
    # ServerAlias directive for localhost IP
    ServerAlias 127.0.0.1

    # Enable HTTP/2 cleartext and HTTP/1.1
    Protocols h2c http/1.1

    # Include common configuration
    Include /etc/apache2/conf-available/vhost-common.conf

    # Redirect to HTTPS
    RewriteEngine On

    # Redirect localhost to port 8443, others to standard HTTPS (port 443)
    RewriteCond %{SERVER_NAME} =localhost
    RewriteRule ^ https://%{SERVER_NAME}:8443%{REQUEST_URI} [R=301,L,NE]
    RewriteCond %{SERVER_NAME} !=localhost
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [R=301,L,NE]
</VirtualHost>

#------------------------------------------------------------------------------
# HTTPS Virtual Host
#------------------------------------------------------------------------------
<VirtualHost *:443>
    # Enable HTTP/2 and HTTP/1.1 over SSL
    Protocols h2 http/1.1

    # SSL Configuration - paths will be updated by 30-ssl.sh script
    # SSLCertificateChainFile will be added dynamically if needed
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/cert.pem
    SSLCertificateKeyFile /etc/apache2/ssl/key.pem

    # Note: Modern SSL/TLS configuration (SSLProtocol, SSLCipherSuite, etc.)
    # is defined globally in apache2.conf and inherited by this virtual host.
    # Only override here if you need site-specific SSL settings.

    # HSTS (HTTP Strict Transport Security)
    <IfModule mod_headers.c>
        Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    </IfModule>

    # Include common configuration
    Include /etc/apache2/conf-available/vhost-common.conf
</VirtualHost>
