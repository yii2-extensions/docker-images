# Apache configuration for Yii2 - Debian Trixie

# Default ServerName to suppress warnings
ServerName localhost

ServerRoot "/etc/apache2"
DefaultRuntimeDir ${APACHE_RUN_DIR}
PidFile ${APACHE_PID_FILE}
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5

User ${APACHE_RUN_USER}
Group ${APACHE_RUN_GROUP}

HostnameLookups Off

# Direct logs to STDOUT/STDERR for container observability
ErrorLog /proc/self/fd/2
LogLevel warn

# Custom log format for containers
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" [%{ms}T ms]" combined_with_time
LogFormat "%h %l %u %t \"%r\" %>s %O [%{ms}T ms]" common_with_time

# Include module configuration
IncludeOptional mods-enabled/*.load
IncludeOptional mods-enabled/*.conf

# Include ports configuration
Listen 80
<IfModule ssl_module>
    Listen 443
</IfModule>

# Security headers
<IfModule headers_module>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Hide Apache version
ServerTokens Prod
ServerSignature Off

# Include other configuration files
IncludeOptional conf-enabled/*.conf
IncludeOptional sites-enabled/*.conf

# Disable problematic default logging
<IfModule log_config_module>
    # Disable other_vhosts_access.log by default
    # This prevents permission issues when running as non-root
</IfModule>
